name: Publish to GitHub Pages

on:
  push:
    branches:
      - main

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: actions/setup-python@v5
        with:
          python-version: 3.x

      - run: pip install -r requirements.txt

      - run: mkdocs gh-deploy --force

      - name: Archive deployment on Wayback Machine
        env:
          TARGET_URL: https://hong-kong-emergency-coordination-hub.github.io/Hong-Kong-Fire-Documentary/
        run: |
          echo "Triggering Wayback Machine snapshot for $TARGET_URL"
          curl --fail --silent --show-error --location \
            --retry 3 --retry-delay 10 \
            "https://web.archive.org/save/$TARGET_URL" \
            --output wayback-response.json
          echo "Wayback Machine response:"
          cat wayback-response.json

